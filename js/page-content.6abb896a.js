import{H as e,I as t,J as a,d as s,K as n,y as o}from"./element-plus.d5014fd1.js";import{J as i,o as r,c as l,a as c,K as g,W as p,X as u,R as d,Q as h,U as C,F as m,a6 as y,O as f,V as L,d as w,e as k,j as N,ag as D,a8 as b}from"./@vue.962d419f.js";import{_ as S,g as z,d as v,c as P,e as $,a as A}from"./index.b9b0d5d7.js";import{d as I}from"./pinia.c32067d4.js";const _=i({props:{listData:{type:Array,required:!0},propList:{type:Array,required:!0},showIndexColumn:{type:Boolean,default:!1},showSelectColumn:{type:Boolean,default:!1},title:{type:String,default:""},countData:{type:Number,default:0},page:{type:Object,default:()=>({currentPage:1,pageSize:10})},childrenProps:{type:Object,default:()=>({})},showFooter:{type:Boolean,default:!0}},emits:["selectionChange","update:page"],setup:(e,{emit:t})=>({handleSelectionChange:e=>{t("selectionChange",e)},handleSizeChange:a=>{t("update:page",{...e.page,pageSize:a})},handleCurrentChange:a=>{t("update:page",{...e.page,currentPage:a})}})}),q={class:"table"},U={class:"header"},j={class:"title"},x={class:"handler"},T={key:0,class:"footer"};const B=S(_,[["render",function(s,n,o,i,w,k){const N=e,D=t,b=a;return r(),l("div",q,[c("div",U,[g(s.$slots,"header",{},(()=>[c("div",j,p(s.title),1),c("div",x,[g(s.$slots,"headerHandler",{},void 0,!0)])]),!0)]),u(D,f({data:s.listData,stripe:"",style:{width:"100%"},onSelectionChange:s.handleSelectionChange,"tooltip-effect":"light"},s.childrenProps),{default:d((()=>[s.showSelectColumn?(r(),h(N,{key:0,type:"selection",align:"center",width:"45"})):C("",!0),s.showIndexColumn?(r(),h(N,{key:1,type:"index",label:"序号",align:"center",width:"60"})):C("",!0),(r(!0),l(m,null,y(s.propList,(e=>(r(),h(N,f({key:e.prop},e,{align:"center","show-overflow-tooltip":""}),{default:d((t=>[g(s.$slots,e.slotName,{row:t.row},(()=>[L(p(t.row[e.prop]),1)]),!0)])),_:2},1040)))),128))])),_:3},16,["data","onSelectionChange"]),s.showFooter?(r(),l("div",T,[g(s.$slots,"footer",{},(()=>[u(b,{"current-page":s.page.currentPage,"page-size":s.page.pageSize,"page-sizes":[30,20,10],layout:"->, total, sizes, prev, pager, next, jumper",total:s.countData,onSizeChange:s.handleSizeChange,onCurrentChange:s.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),!0)])):C("",!0)])}],["__scopeId","data-v-502fd0d7"]]),R=I("mainSystem",{state:()=>({usersList:[],usersCount:0,roleList:[],roleCount:0,goodsList:[],goodsCount:0,menuList:[],menuCount:0,departmentList:[],departmentCount:0,categoryList:[],categoryCount:0,storyList:[],storyCount:0}),getters:{pageListData:e=>t=>e[`${t}List`],pageCountData:e=>t=>e[`${t}Count`]},actions:{async getPageListAction(e){const t=e.pageName,a=`/${t}/list`,s=await z(a,e.queryInfo),{list:n,totalCount:o}=s.data;switch(t){case"users":this.changeUsersList(n),this.changeUsersCount(o);break;case"role":this.changeRoleList(n),this.changeRoleCount(o);break;case"goods":this.changeGoodsList(n),this.changeGoodsCount(o);break;case"menu":this.changeMenuList(n),this.changeMenuCount(o);break;case"department":this.changeDepartmentList(n),this.changeDepartmentCount(o);break;case"category":this.changeCategoryList(n),this.changeCategoryCount(o);break;case"story":this.changeStoryList(n),this.changeStoryCount(o)}},async deletePageDataAction(e){const{pageName:t,id:a}=e,s=`/${t}/${a}`;await v(s),this.getPageListAction({pageName:t,queryInfo:{offset:0,size:10}})},async createPageDataAction(e){const{pageName:t,newData:a}=e,s=`/${t}`;await P(s,a),this.getPageListAction({pageName:t,queryInfo:{offset:0,size:10}})},async editPageDataAction(e){const{pageName:t,editData:a,id:s}=e,n=`/${t}/${s}`;await $(n,a),this.getPageListAction({pageName:t,queryInfo:{offset:0,size:10}})},changeUsersList(e){this.usersList=e},changeUsersCount(e){this.usersCount=e},changeRoleList(e){this.roleList=e},changeRoleCount(e){this.roleCount=e},changeGoodsList(e){this.goodsList=e},changeGoodsCount(e){this.goodsCount=e},changeMenuList(e){this.menuList=e},changeMenuCount(e){this.menuCount=e},changeDepartmentList(e){this.departmentList=e},changeDepartmentCount(e){this.departmentCount=e},changeCategoryList(e){this.categoryList=e},changeCategoryCount(e){this.categoryCount=e},changeStoryList(e){this.storyList=e},changeStoryCount(e){this.storyCount=e}}});function V(e,t){const a=A().$state.permissions,s=`system:${e}:${t}`;return!!a.find((e=>e===s))}const G=i({components:{UserTable:B},props:{contentTableConfig:{type:Object,required:!0},pageName:{type:String,required:!0}},emits:["newBtnClick","editBtnClick","btnName"],setup(e,{emit:t}){const a=R(),s=V(e.pageName,"create"),n=V(e.pageName,"update"),o=V(e.pageName,"delete"),i=V(e.pageName,"query"),r=w({currentPage:1,pageSize:10});k(r,(()=>l()));const l=(t={})=>{i&&a.getPageListAction({pageName:e.pageName,queryInfo:{offset:(r.value.currentPage-1)*r.value.pageSize,size:r.value.pageSize,...t}})};l();const c=N((()=>a.pageListData(e.pageName))),g=N((()=>a.pageCountData(e.pageName))),p=e.contentTableConfig?.propList.filter((e=>"status"!==e.slotName&&("createAt"!==e.slotName&&("updateAt"!==e.slotName&&"handler"!==e.slotName))));return{usersListData:c,getPageData:l,usersListCount:g,pageInfo:r,otherPropSlots:p,isCreate:s,isUpdate:n,isDelete:o,handleDeleteClick:t=>{a.deletePageDataAction({pageName:e.pageName,id:t.id})},handleNewClick:()=>{t("newBtnClick")},handleEditClick:e=>{t("editBtnClick",e)}}}}),M={class:"page-content"},O={class:"handle-btns"};const E=S(G,[["render",function(e,t,a,i,m,w){const k=s,N=n,S=o,z=D("user-table");return r(),l("div",M,[u(z,f({listData:e.usersListData},e.contentTableConfig,{countData:e.usersListCount,page:e.pageInfo,"onUpdate:page":t[0]||(t[0]=t=>e.pageInfo=t),"row-key":"id","tree-props":{children:"children"},propList:e.contentTableConfig.propList}),b({header:d((()=>[])),headerHandler:d((()=>[e.isCreate?(r(),h(k,{key:0,plain:"",size:"small",type:"primary",onClick:e.handleNewClick},{default:d((()=>[L(p(e.contentTableConfig.btnName),1)])),_:1},8,["onClick"])):C("",!0)])),status:d((e=>[u(S,{class:"box-item",effect:"light",content:e.row.status?"启用":"禁用",placement:"top",offset:0,"show-arrow":!1},{default:d((()=>[u(N,{modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":e.row.status,disabled:!0,size:"small"},null,8,["modelValue","onUpdate:modelValue","active-value"])])),_:2},1032,["content"])])),createAt:d((t=>[c("span",null,p(e.$filters.formatTime(t.row.createAt)),1)])),updateAt:d((t=>[c("span",null,p(e.$filters.formatTime(t.row.updateAt)),1)])),handler:d((t=>[c("div",O,[e.isCreate?(r(),h(k,{key:0,icon:"EditPen",size:"small",type:"primary",text:"",onClick:a=>e.handleEditClick(t.row)},{default:d((()=>[L(" 修改 ")])),_:2},1032,["onClick"])):C("",!0),e.isCreate?(r(),h(k,{key:1,icon:"Delete",size:"small",type:"danger",text:"",onClick:a=>e.handleDeleteClick(t.row)},{default:d((()=>[L(" 删除 ")])),_:2},1032,["onClick"])):C("",!0)])])),footer:d((()=>[])),_:2},[y(e.otherPropSlots,(t=>({name:t.slotName,fn:d((a=>[t.slotName?g(e.$slots,t.slotName,{key:0,row:a.row},void 0,!0):C("",!0)]))})))]),1040,["listData","countData","page","propList"])])}],["__scopeId","data-v-70da6753"]]);export{E as P,R as s};
